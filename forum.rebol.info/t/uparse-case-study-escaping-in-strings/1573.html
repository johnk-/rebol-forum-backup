<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>UPARSE Case Study: Escaping In Strings - Parsing - AltRebol</title>
    <meta name="description" content="I wanted to make a REWORD variation that would look for escaped parts of strings and extract them as words.  So: 
Input: &amp;quot;abc$(def)ghi&amp;quot;
Output: [&amp;quot;abc&amp;quot; def &amp;quot;ghi&amp;quot;]

It&amp;#39;s a common-seeming and not entirely trivial task.  The&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1573.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;UPARSE Case Study: Escaping In Strings&#39;" href="1573.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/uparse-case-study-escaping-in-strings/1573" />
<meta name="twitter:url" content="https://forum.rebol.info/t/uparse-case-study-escaping-in-strings/1573" />
<meta property="og:title" content="UPARSE Case Study: Escaping In Strings" />
<meta name="twitter:title" content="UPARSE Case Study: Escaping In Strings" />
<meta property="og:description" content="I wanted to make a REWORD variation that would look for escaped parts of strings and extract them as words.  So:  Input: &quot;abc$(def)ghi&quot; Output: [&quot;abc&quot; def &quot;ghi&quot;]  It&#39;s a common-seeming and not entirely trivial task.  The first thing I came up with is a bit convoluted...perhaps because I tried to not repeat the &quot;$(&quot; and &quot;)&quot; strings in the rule:  uparse text [     return collect [         any [             not end             (capturing: false)             keep opt between here [&quot;$(&quot; (capturing: t..." />
<meta name="twitter:description" content="I wanted to make a REWORD variation that would look for escaped parts of strings and extract them as words.  So:  Input: &quot;abc$(def)ghi&quot; Output: [&quot;abc&quot; def &quot;ghi&quot;]  It&#39;s a common-seeming and not entirely trivial task.  The first thing I came up with is a bit convoluted...perhaps because I tried to not repeat the &quot;$(&quot; and &quot;)&quot; strings in the rule:  uparse text [     return collect [         any [             not end             (capturing: false)             keep opt between here [&quot;$(&quot; (capturing: t..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 â¤" />
<meta property="article:published_time" content="2021-03-27T13:44:38+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1573.html">UPARSE Case Study: Escaping In Strings</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/15" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Domains</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/domains/parsing/16" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #F1592A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Parsing</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1573.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-03-27T13:44:38Z' class='post-time'>
                March 27, 2021,  1:44pm
              </time>
              <meta itemprop='dateModified' content='2021-03-27T13:44:38Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I wanted to make a REWORD variation that would look for escaped parts of strings and extract them as words.  So:</p>
<pre><code>Input: "abc$(def)ghi"
Output: ["abc" def "ghi"]
</code></pre>
<p>It's a common-seeming and not entirely trivial task.  The first thing I came up with is a bit convoluted...perhaps because I tried to not repeat the "$(" and ")" strings in the rule:</p>
<pre><code>uparse text [
    return collect [
        any [
            not end
            (capturing: false)
            keep opt between here ["$(" (capturing: true) | end]
            :(if capturing '[
                inner: between here ")"
                keep @(as word! inner)
            ])
        ]
    ]
]
</code></pre>
<p>It basically alternates between a capturing mode and a non-capturing mode.  It decides if it needs to run a capture mode with a variable.</p>
<p>It has to throw in a <a href="../any-vs-while-and-not-end/1572.html">NOT END for reasons I explain in another post</a>.  Because it's running alternating rules that may both opt out.</p>
<p>I use a GET-GROUP! spliced conditional rule, as UPARSE doesn't have any loop-interrupting constructs yet.  So you can't say "Stop running this rule, but consider it to have matched."  There's only LOGIC! of #[false] which means what FAIL used to mean...e.g. the overall rule did not match (so any collected material would be forgotten).</p>
<p>Since it can't break out of the rule and report success, it has to have a way to skip over a rule.  So the rule for capturing inside the parentheses conditions itself out with an IF statement and a generated rule.  I could have instead written that as an alternate rule, where if <code>not capturing</code> was true it would bypass normal code:</p>
<pre><code>uparse text [
    return collect [
        any [
            not end
            (capturing: false)
            keep opt between here ["$(" (capturing: true) | end]
            [:(not capturing) |
                inner: between here ")"
                keep @(as word! inner)
            ]
        ]
    ]
]
</code></pre>
<p>That feels more convoluted to me because of the inverse logic of the NOT, though.</p>
<p>It produces more empty strings than I would like:</p>
<pre><code>Input: "$(abc)$(def)$(ghi)"
Output: ["" abc "" def "" ghi]
</code></pre>
<p>It would technically be possible for a rule like BETWEEN to succeed and give a NULL result if there were no content, instead of an empty string:</p>
<pre><code>&gt;&gt; did parse "()" [x: between "(" ")"]
== #[true]

&gt;&gt; x
; null
</code></pre>
<p>But this then means you can't get a good distinction of what happened in the case of an optional rule.</p>
<pre><code>&gt;&gt; did parse "" [x: opt between "(" ")"]
== #[true]

&gt;&gt; x
; null...so were there parentheses or not?
</code></pre>
<p>So I guess it's another situation where if you want to filter out the empty strings, you have to capture into a variable and filter it.</p>
<p><strong>I think UPARSE helps out here...but it's not quite the slam dunk I'd hope for.</strong></p>
<p>Because it has two rules that may both opt themselves out, it's a thought piece for asking if the NOT END makes sense with ANY.  Or is it better off baking that into the ANY rule and having another construct?  Intuitively I feel like the tax of having two slightly different versions and explaining the use of one vs. the other is worse than just having the more general construct.</p>
<p>If there were a loop-ending construct that indicated the overall rule was a success (e.g. didn't discard the KEEPs), then we might avoid the capturing flag:</p>
<pre><code>uparse text [
    return collect [
        any [
            keep opt between here ["$(" | end]
            [end break |
                inner: between here ")"
                keep @(as word! inner)
            ]
        ]
    ]
]
</code></pre>
<p>But I don't know if BREAK is the right name for a loop-accepting operation (as in DO's while this typically causes most loop operations to return NULL).  So I'd think it would perhaps discard anything kept.  Perhaps STOP would be more consistent, and it could be value-bearing as well (<strong>stop @(...)</strong>)</p>
<p>Loop breaking operations would be another potential argument for <a href="../any-vs-while-and-not-end/1572.html">renaming ANY to WHILE</a>, as it would hint more clearly at the existence of a BREAK.  Though WHILE has no STOP in plain DO currently (only CYCLE does) due to the desire to make loops easier to abstract.</p>
        </div>

        <meta itemprop='headline' content='UPARSE Case Study: Escaping In Strings'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
