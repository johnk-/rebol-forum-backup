<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Promises, Promises: Should THEN and ELSE be used for them? - Foreign Inspiration - AltRebol</title>
    <meta name="description" content="Tinkering with JavaScript again after some years of being blissfully ignorant, I notice that a style of programming which used to be popular there has caught on even more.  These are &amp;quot;Promises&amp;quot;--which I&amp;#39;ve seen under oth&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="734.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Promises, Promises: Should THEN and ELSE be used for them?&#39;" href="734.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/promises-promises-should-then-and-else-be-used-for-them/734" />
<meta name="twitter:url" content="https://forum.rebol.info/t/promises-promises-should-then-and-else-be-used-for-them/734" />
<meta property="og:title" content="Promises, Promises: Should THEN and ELSE be used for them?" />
<meta name="twitter:title" content="Promises, Promises: Should THEN and ELSE be used for them?" />
<meta property="og:description" content="Tinkering with JavaScript again after some years of being blissfully ignorant, I notice that a style of programming which used to be popular there has caught on even more.  These are &quot;Promises&quot;--which I&#39;ve seen under other names like &quot;Futures&quot;.  They&#39;ve become so ingrained that they&#39;re now in the JavaScript language itself:    (Note: Worth pointing out is that there&#39;s a fundamental feature missing from the built-in promises, namely cancellation.  Kind of makes you roll your eyes when you see som..." />
<meta name="twitter:description" content="Tinkering with JavaScript again after some years of being blissfully ignorant, I notice that a style of programming which used to be popular there has caught on even more.  These are &quot;Promises&quot;--which I&#39;ve seen under other names like &quot;Futures&quot;.  They&#39;ve become so ingrained that they&#39;re now in the JavaScript language itself:    (Note: Worth pointing out is that there&#39;s a fundamental feature missing from the built-in promises, namely cancellation.  Kind of makes you roll your eyes when you see som..." />
<meta property="article:published_time" content="2018-07-12T08:34:53+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="734.html">Promises, Promises: Should THEN and ELSE be used for them?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/foreign-inspiration.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Foreign Inspiration</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="734.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-07-12T08:34:53Z' class='post-time'>
                July 12, 2018,  8:34am
              </time>
              <meta itemprop='dateModified' content='2018-07-12T08:34:53Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Tinkering with JavaScript again after some years of being blissfully ignorant, I notice that a style of programming which used to be popular there has caught on even more.  These are "Promises"--which I've seen under other names like "Futures".</p>
<p>They've become so ingrained that they're now in the JavaScript language itself:</p>
<aside class="onebox allowlistedgeneric">
  <header class="source">
      <img src="https://developer.mozilla.org/static/img/favicon32.7f3da72dcea1.png" class="site-icon" width="32" height="32">
      <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">MDN Web Docs</a>
  </header>
  <article class="onebox-body">
    <img src="https://developer.mozilla.org/static/img/opengraph-logo.72382e605ce3.png" class="thumbnail onebox-avatar" width="500" height="500">

<h3><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">Promise</a></h3>

<p>The Promise object represents the eventual completion (or failure) of an asynchronous operation and its resulting value.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p><em>(Note: Worth pointing out is that there's a fundamental feature missing from the built-in promises, namely <a href="https://stackoverflow.com/a/30235261/211160">cancellation</a>.  Kind of makes you roll your eyes when you see someone deploy a major language feature to a worldwide audience--as if it's "the future of asynchronous programming and network requests"--when there's no way to cancel.)</em></p>
<p>When you have a promise in your hand, you can hook it up to clauses that will run if it succeeds, and clauses to run if it fails.  You hook them together with successive function calls...where the THEN clauses are the successes, and the CATCH clauses are the failures:</p>
<pre><code>some_promise.then(
    function(val) {
        log.insertAdjacentHTML('beforeend', val +
            ') Promise fulfilled (&lt;small&gt;Async code terminated&lt;/small&gt;)&lt;br/&gt;');
    }).catch(
    // Log the rejection reason
   (reason) =&gt; {
        console.log('Handle rejected promise ('+reason+') here.');
    });
</code></pre>
<p>You can make loooong chains out of these.  Steps can be triggered by callbacks, or even by just an ordinary non-promise value falling through immediately from the previous step.  It may help to look at a big example <em>(from <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-promise-27fc71e77261">this article</a>, if it looks weird with <code>const</code> and <code>=&gt;</code> remember that JavaScript has changed a bit, and this stuff is in it now)</em>:</p>
<pre><code>const wait = time =&gt; new Promise(
   res =&gt; setTimeout(() =&gt; res(), time)
);

wait(200)
   // onFulfilled() can return a new promise, `x`
  .then(() =&gt; new Promise(res =&gt; res('foo')))
  // the next promise will assume the state of `x`
  .then(a =&gt; a)
  // Above we returned the unwrapped value of `x`
  // so `.then()` above returns a fulfilled promise
  // with that value:
  .then(b =&gt; console.log(b)) // 'foo'
  // Note that `null` is a valid promise value:
  .then(() =&gt; null)
  .then(c =&gt; console.log(c)) // null
  // The following error is not reported yet:
  .then(() =&gt; {throw new Error('foo');})
  // Instead, the returned promise is rejected
  // with the error as the reason:
  .then(
    // Nothing is logged here due to the error above:
    d =&gt; console.log(`d: ${ d }`),
    // Now we handle the error (rejection reason)
    e =&gt; console.log(e)) // [Error: foo]
  // With the previous exception handled, we can continue:
  .then(f =&gt; console.log(`f: ${ f }`)) // f: undefined
  // The following doesn't log. e was already handled,
  // so this handler doesn't get called:
  .catch(e =&gt; console.log(e))
  .then(() =&gt; { throw new Error('bar'); })
  // When a promise is rejected, success handlers get skipped.
  // Nothing logs here because of the 'bar' exception:
  .then(g =&gt; console.log(`g: ${ g }`))
  .catch(h =&gt; console.log(h)) // [Error: bar]
;
</code></pre>
<p>This resembles the kind of chaining done with enfix, so...</p>
<h2>...might THEN and ELSE be promise-aware?</h2>
<p>JavaScript uses the name THEN here to mean "do this thing on the right <em>if the left happens</em>" or "<em>if the left is fulfilled</em>".  You can get a "false" result back from a promise:</p>
<pre><code>var falsify = new Promise(
   resolve =&gt; {
       resolve(false) // calling resolve will fulfill the promise
   }
);

falsify.then(x =&gt; console.log(x)) // this will print out false
</code></pre>
<p>Seeing that concept as a meaning for THEN helped provoke me into pushing things around to <a href="../taking-then-back-as-the-rightful-complement-to-else/731.html">change THEN back to <em>not</em> being an enfix form of IF</a>.  It was a no-brainer to do that, once I realized that the blocking issue of <strong>all [...] then [...]</strong> was no longer blocking.</p>
<p>But here we have to ask a question about what the rules are for the system.  If you see something like:</p>
<pre><code>all [...] then [print "done with all that stuff"]
print "moving on..."
</code></pre>
<p>Would you want the system to be based on a worldview where that could output:</p>
<pre><code>"moving on..."
"done with all that stuff"
</code></pre>
<p>If you have a PROMISE! datatype in the picture, then programs which use them will become asynchronous even if they don't appear to be written in an asynchronous style.  The more automatic it is, the greater the risks become.</p>
<p>JavaScript's promises involve very little system support.  Not only were most promise library designs done before the language supported them at all, one of the most popular implementations <a href="http://bluebirdjs.com/docs/getting-started.html">doesn't even use the new JS built-in promises</a>...but cooks up its own using functions and objects.</p>
<p>So this is different from what Gabriele was suggesting when he brought up promises <a href="../places-to-look-for-port-prior-art/621/3.html">as a likely path forward for PORT!s</a> in his Topaz design notes.  He's suggesting that a PROMISE! would be an active datatype, where if you merely said <strong>data: read url</strong> and got a promise back, then <strong>length of data</strong>, it would automatically wait until the length was known.  You wouldn't have to explicitly WAIT on it (or have a THEN, as suggested above).</p>
<p>It's trying to suggest a synchronous client of READ could go on their merry way using it just as if they got bytes back, or tactically drill in with promise-aware constructs on an as-needed basis.  As nice as that sounds it's <em>not realistic</em>.  What you'd need to accomplish such a goal more or less asks the runtime support for lazy evaluation, and the restrictions that brings in would push back to where the user's style of programming would have to morph into something much more like Haskell than like Rebol/JavaScript/etc.</p>
<p>JavaScript's answer is to quarantine down the promise-aware constructs of the language to more or less <em>zero</em>.  Their if() treats them as truthy, not "wait on them asynchronously and see if the result was truthy, or falsey if an error".  Things like .then() are methods on the promise itself, not generic language operators.</p>
<p>As I've pointed out that people aren't even necessarily with the built-in promises of JavaScript--enough to continue using libraries that cobble the protocols together out of objects and functions--it may suggest that zero is not a good sweet spot for language support.  To really be compelling enough for pervasive use there may need to be some special sauce you don't get elsewhere (including, I'd have to say, cancellation).</p>
<p>I do wonder if conditionals could be a place where it might be good to synchronize a promise.  Or if ANY and ALL could imply WAITs.  But certainly it seems like it would be appealing if THEN and ELSE could be used...so I guess that's what I'll put out there for a starting thought.</p>
        </div>

        <meta itemprop='headline' content='Promises, Promises: Should THEN and ELSE be used for them?'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/asampal'><span itemprop='name'>asampal</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="734.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2018-07-12T13:49:08Z'>
              <time itemprop='dateModified' datetime='2018-07-12T13:53:36Z' class='post-time'>
                July 12, 2018,  1:53pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Not sure if you looked at JavaScript's <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="nofollow noopener">async/await</a> notation as a "nicer" (or synchronous-looking) way to use promises or asynchronous operations. Would something similar make sense for Ren-C? I mentioned these in the chat, I think, but you didn't comment.</p>
        </div>

        <meta itemprop='headline' content='Promises, Promises: Should THEN and ELSE be used for them?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="734.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-07-12T14:16:59Z' class='post-time'>
                July 12, 2018,  2:16pm
              </time>
              <meta itemprop='dateModified' content='2018-07-12T14:16:59Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="2" data-topic="734">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.rebol.info/asampal/40/3_2.png" class="avatar"> asampal:</div>
<blockquote>
<p>Would something similar make sense for Ren-C?</p>
</blockquote>
</aside>
<p>Okay, well that revises the number of native JavaScript keywords for promises to, like, two.</p>
<p><a href="https://javascript.info/async-await" rel="nofollow noopener"><code>https://javascript.info/async-await</code></a></p>
<p>So yes, in Rebol it would make sense to assign that to WAIT.  I was talking about that kind of thing, but also whether there are <em>implicit</em> waits in the system, or if it's always explicit.</p>
<p>We have sort of idealized being able to write things like:</p>
<pre><code>if parse read http://example.com [...] [
    ...
]
</code></pre>
<p>But complexity rears its head and you start saying "well, how does it know if you want the UTF-8 bytes or if you want it to decode the URL as an IMAGE!" or whatever.  Is READ always bytes, and LOAD is higher level?  READ/STRING is certainly very limited and weird...refinements don't seem like an answer.</p>
<p>So maybe READ is byte-oriented, so that's LOAD which is higher level and does more sniffing to check the content-type.  But now, we ask if the asynchronous situation is such that synchronous clients have to say:</p>
<pre><code>if parse wait load http://example.com [...] [
    ...
]
</code></pre>
<p>Questions we start pushing around in our head is whether or not a synchronous client should have to put an extra word in there or not.  WAIT is a short word and keeps things explicit--it's not as far-out-there as Gabriele's imagining.  In this scenario, if you forget the WAIT then PARSE just says it doesn't know how to parse promises (whatever their implementation is).</p>
<p>But the principal question I'm throwing in here for starters is if it's comfortable having THEN and ELSE serve a dualistic purpose of these promise handlings, as well as their current function.  I imagine it is.</p>
<hr>
<p>One thing that has to be confronted is that Rebol is not very efficient with:</p>
<pre><code> some-promise then function [x] [...lots of code...]
 some-promise then x =&gt; [...lots of code...]
</code></pre>
<p>Each time at source-level you make a function like that, it goes through the motions of creating a new ACTION! object, relativizing the body, etc.  Making matters even worse, it will do this whole process whether the function is used or not.</p>
<p>While this looks terribly inefficient and lame for a static scenario, what makes it interesting is all the flexibility it permits with dynamically creating that function.  Not having that dynamism sucks.  You can avoid it with constructs you might offer people to use at an outer level in a prepass:</p>
<pre><code>composeIII [
    ...
    ...
    some-promise then (((x =&gt; [...lots of code...])))
    ...
    ...
]
</code></pre>
<p>But if you need to capture things from the environment that won't work.  This does make something like an await/WAIT better from an efficiency standpoint.</p>
<p>Anyway, there's a lot of stuff to contemplate, so if people want to work through examples and make lists and do analysis that would be helpful.</p>
        </div>

        <meta itemprop='headline' content='Promises, Promises: Should THEN and ELSE be used for them?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
