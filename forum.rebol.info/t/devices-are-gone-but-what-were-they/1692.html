<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Devices are gone. (But what were they?) - Ports - AltRebol</title>
    <meta name="description" content="Something in R3-Alpha that has been a major tax and holding back interesting development is &amp;quot;The Device Layer&amp;quot;. 
What Was the Device Layer, Anyway?
Carl wanted what most developers of a language would want: to factor out&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1692.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Devices are gone. (But what were they?)&#39;" href="1692.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/devices-are-gone-but-what-were-they/1692" />
<meta name="twitter:url" content="https://forum.rebol.info/t/devices-are-gone-but-what-were-they/1692" />
<meta property="og:title" content="Devices are gone. (But what were they?)" />
<meta name="twitter:title" content="Devices are gone. (But what were they?)" />
<meta property="og:description" content="Something in R3-Alpha that has been a major tax and holding back interesting development is &quot;The Device Layer&quot;.  What Was the Device Layer, Anyway? Carl wanted what most developers of a language would want: to factor out the logic of the language from the details of any particular operating system.  Thus you need some kind of abstraction.  One might think that PORT! is this level of abstraction for Rebol.  You would develop a TCP PORT! for POSIX, and a TCP PORT! for Windows.  Each would implemen..." />
<meta name="twitter:description" content="Something in R3-Alpha that has been a major tax and holding back interesting development is &quot;The Device Layer&quot;.  What Was the Device Layer, Anyway? Carl wanted what most developers of a language would want: to factor out the logic of the language from the details of any particular operating system.  Thus you need some kind of abstraction.  One might think that PORT! is this level of abstraction for Rebol.  You would develop a TCP PORT! for POSIX, and a TCP PORT! for Windows.  Each would implemen..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins ðŸ•‘" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="2 â¤" />
<meta property="article:published_time" content="2021-08-29T04:19:18+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1692.html">Devices are gone. (But what were they?)</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/ports/37" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Ports</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1692.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-08-29T04:19:18Z'>
              <time itemprop='dateModified' datetime='2021-08-29T08:38:56Z' class='post-time'>
                August 29, 2021,  8:38am
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Something in R3-Alpha that has been a major tax and holding back interesting development is "The Device Layer".</p>
<h2>What Was the Device Layer, Anyway?</h2>
<p>Carl wanted what most developers of a language would want: to factor out the logic of the language from the details of any particular operating system.</p>
<p>Thus you need some kind of abstraction.</p>
<p>One might think that PORT! is this level of abstraction for Rebol.  You would develop a TCP PORT! for POSIX, and a TCP PORT! for Windows.  Each would implement the same READ and WRITE and OPEN methods as appropriate for the operating system.</p>
<p>But instead, he wanted to have there be one codebase for the TCP PORT! (or the file PORT!, or whatever) and it would talk to an "abstracted OS".  This abstracted OS was a placeholder for any operating system that knew nothing about Rebol datatypes or values, and you could only communicate with it using raw C datatypes and structures.</p>
<p><strong>This actually isn't a terrible idea, in theory.</strong> And it's kind of what libuv is.</p>
<p><strong>But in practice, it was a bad implementation.</strong>  Rebol paid the price in stagnant development due to its obfuscating and limiting nature.</p>
<h2>A Layer Entirely Of Make-Work</h2>
<p>Communicating with the device layer was done with a structure called a REBREQ.  A REBREQ was basically a bag of anything that might be interesting to any request.  So the prototypes for absolutely everything looked the same.</p>
<pre><code>DEVICE_CMD Open_Socket(REBREQ *sock)

DEVICE_CMD Read_File(REBREQ *file)

DEVICE_CMD Query_Event(REBREQ *event)
</code></pre>
<p>etc.</p>
<p>A REBREQ was a giant mystery box--a structure filled with fields and flags.  It was both input and output.  Some were relevant to whatever it was you were trying to do...some not.  There were barely any invariants or asserts to keep it sane.</p>
<p>So if you were implementing something like the READ operation on a file port:</p>
<ul>
<li>
<p>you would have to dissect the Rebol arguments in order to pack them all into a REBREQ, guessing and hoping which fields or flags you should pay attention to.</p>
</li>
<li>
<p>Then you'd have to go over to the Windows implementation for the device layer of Read_File and unpack those parameters--all pure C structs--and call the windows ReadFile() function.</p>
</li>
<li>
<p>Then you'd have to do the same with the POSIX calling read(), or any other OS</p>
</li>
<li>
<p>You'd also for each OS have to proxy whatever you read back into the REBREQ--again remembering you can't assemble any Rebol values yet...because that is done once you get back to the PORT!'s READ.</p>
</li>
</ul>
<h2>But did it Do <em>Anything</em> Useful?</h2>
<p>So this is where the problem is.  For synchronous operations, no.  It was entirely make-work. And the asynchronous code was a mire.</p>
<p>The reason it didn't get ripped out sooner was because it was playing a role in asynchronous operations.  A weird and nearly impossible to see role, that tried to implement a generic linked list that could handle the needs of any interface.</p>
<p>I think it's much clearer to have each extension maintain its own linked lists if it wants to.</p>
<h2>Was Carl Not Serious About Simplicity?</h2>
<p>Well, it was a couple of decades ago, so one should cut some slack.  If one were to be generous, one might say he was aiming to accomplish something like libuv.</p>
<p>But big picture, I think this is what happened:</p>
<p>Carl knew that to get performance, you'd have to be close to the core of Rebol...knowing the internals of the bits of the values etc.  And he wasn't intending to publish the source for that.  But he wanted the platform support to be implementable by third parties.</p>
<p>Hence the concept became <em>"in the port implementation, we'll efficiently strip it down to the bit layer with the knowledge we have...and the device layer will be that little last bit, devices won't really do anything."</em></p>
<p>In truth, devices do a lot.  They are what you get when people with computers want to do things.  And you wind up in a mess when the 7 verbs you thought of with READ, WRITE, CONNECT, OPEN, CLOSE are missing huge swaths of what you want to do with a GPS or anything else that comes down the pipe.</p>
<p>So anyway, it's in a better direction now...without the make-work.  All the usermode code for TLS and HTTP seem to still be working, but report any problems.</p>
        </div>

        <meta itemprop='headline' content='Devices are gone. (But what were they?)'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../belated-2021-post-mortem-new-years-2022-vision/1786.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/belated-2021-post-mortem-new-years-2022-vision/1786'>
                      <span itemprop='name'>Belated 2021 Post-Mortem + New Years 2022 Vision ðŸ¤¹</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
