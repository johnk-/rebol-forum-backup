<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>The now even-more-special SPECIALIZE - Feature Discover - AltRebol</title>
    <meta name="description" content="An early-ish addtion to Ren-C was SPECIALIZE.  It creates a variation of a function which has some parameters removed, because they have been set to constant values. 

The syntax is that you give it a FUNCTION! (or a WOR&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="588.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;The now even-more-special SPECIALIZE&#39;" href="588.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/the-now-even-more-special-specialize/588" />
<meta name="twitter:url" content="https://forum.rebol.info/t/the-now-even-more-special-specialize/588" />
<meta property="og:title" content="The now even-more-special SPECIALIZE" />
<meta name="twitter:title" content="The now even-more-special SPECIALIZE" />
<meta property="og:description" content="An early-ish addtion to Ren-C was SPECIALIZE.  It creates a variation of a function which has some parameters removed, because they have been set to constant values.  The syntax is that you give it a FUNCTION! (or a WORD! or PATH! by which it can find a function), and a block of code.  It will bind the SET-WORD!s in that block to the parameter names of the function you are specializing.  Then it will run it:  &gt;&gt; append-abc: specialize &#39;append/only [     print &quot;block runs arbitrary code!&quot;     if ..." />
<meta name="twitter:description" content="An early-ish addtion to Ren-C was SPECIALIZE.  It creates a variation of a function which has some parameters removed, because they have been set to constant values.  The syntax is that you give it a FUNCTION! (or a WORD! or PATH! by which it can find a function), and a block of code.  It will bind the SET-WORD!s in that block to the parameter names of the function you are specializing.  Then it will run it:  &gt;&gt; append-abc: specialize &#39;append/only [     print &quot;block runs arbitrary code!&quot;     if ..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ❤" />
<meta property="article:published_time" content="2018-04-12T12:27:11+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="588.html">The now even-more-special SPECIALIZE</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/usage/7" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #3AB54A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Usage</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/usage/feature-discover.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #3AB54A'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Feature Discover</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="588.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-04-12T12:27:11Z' class='post-time'>
                April 12, 2018, 12:27pm
              </time>
              <meta itemprop='dateModified' content='2018-04-12T12:27:11Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>An early-ish addtion to Ren-C was SPECIALIZE.  It creates a variation of a function which has some parameters removed, because they have been set to constant values.</p>
<p>The syntax is that you give it a FUNCTION! (or a WORD! or PATH! by which it can find a function), and a block of code.  It will bind the SET-WORD!s in that block to the parameter names of the function you are specializing.  Then it will run it:</p>
<pre><code>&gt;&gt; append-abc: specialize 'append/only [
    print "block runs arbitrary code!"
    if 1 &lt; 2 [value: [a b c]]
]
block runs arbitrary code!

&gt;&gt; block: copy [x y]

&gt;&gt; append-abc block
== [x y [a b c]]
</code></pre>
<p><em>(Note: One disadvantage of this particular syntax is that it ties you to the names of the parameters.  That's not an intrinsic flaw of the specialization mechanic, just this SPECIALIZE native, and other ways of making the generator are possible if people wanted to.)</em></p>
<h3>Not a frivolous feature--a CRITICAL one</h3>
<p>Whatever the syntax of specializations, they were <em>very important</em> to add.  They're key to reducing the size of the language definition.  Because otherwise, you haven't clearly captured the relationships between functions...you wind up with a lot of slightly different code saying the same thing.  Each re-implementation is a chance for introducing some weird variation!</p>
<p>For instance: in R3-Alpha, how were FIRST, SECOND, THIRD, ... defined?  They were <a href="https://github.com/rebol/rebol/blob/25033f897b2bd466068d7663563cd3ff64740b94/src/core/n-data.c#L660" rel="nofollow noopener">all their own NATIVEs</a>...each one implemented with the C function <code>Do_Ordinal()</code>.  As it so happens, the implementation mechanism was very dicey.  But it also raises a question for anyone who wants to write ELEVENTH... do you have to crack open the C to do that?</p>
<p>By defining <strong>first: specialize 'pick [picker: 1]</strong>, the pattern is much clearer.  This mode of cleanup was applied in many places, avoiding writing more C code when the relationship could just be established in Rebol.</p>
<h3>But it had to be fast...</h3>
<p>For specialization to be palatable, the design had to be done in such a way that it didn't get slower.</p>
<p>Consider in R3-Alpha: what if you wanted a version of APPEND that always had /ONLY, but wanted to expose all the existing refinements and documentation?  Let's do it the "easy" way <em>(which makes assumptions that a correct answer would need PARSE and a whole lot of edge case processing to get right)</em></p>
<pre><code>r3-alpha&gt; spec: spec-of :append
r3-alpha&gt; remove/part (find spec /only) 2
r3-alpha&gt; apo: func spec [
    apply/only :append reduce [
        :series :value :part :length :only :dup :count
    ]
]

r3-alpha&gt; delta-time [block: copy [] loop 100000 [apo block [a]]]
== 0:00:00.114358

r3-alpha&gt; delta-time [block: copy [] loop 100000 [append/only block [a]]]
== 0:00:00.034088
</code></pre>
<p>So now you have something that's almost 4x as slow.  In Ren-C:</p>
<pre><code>ren-c&gt; apo: specialize 'append [only: true]

ren-c&gt; delta-time [block: copy [] loop 100000 [apo block [a]]]
== 0:00:00.053084

ren-c&gt; delta-time [block: copy [] loop 100000 [append/only block [a]]]
== 0:00:00.047722
</code></pre>
<p>It's nice to see Ren-C is indeed within striking distance performance-wise on the plain APPEND/ONLY.  (The evaluator is doing <em>an incredible lot more</em> for that price, but I still aim to narrow that gap...as time permits).  But that aside, think of the specialization in relative terms...it added only about 12%.</p>
<p>Driving this margin down makes us comfortable defining one function in terms of another, without feeling anxious and thinking it has to be done in C.</p>
<h3>Partial Refinements</h3>
<p>One thing that the early SPECIALIZE could not do was let you provide refinements without all of their arguments.  That is because what it was doing was storing a value in each argument position.  And TRUE for a refinement isn't enough to know where the order is.</p>
<p>This blocked an interesting feature, namely being able to specialize functions with GET-PATH!.  Consider these situations:</p>
<pre><code>foo: func [/ref1 arg1 /ref2 arg2 /ref3 arg3] [...]

foo23: :foo/ref2/ref3
foo32: :foo/ref3/ref2

foo23 A B ;-- should give A to arg2 and B to arg3
foo32 A B ;-- should give B to arg2 and A to arg3
</code></pre>
<p>Merely filling in the slots for the refinements specified with TRUE will not provide enough information for a call to be able to tell the difference between the intents. Also, a call to <code>foo23/ref1 A B C</code> does not want to make arg1 A, because it should act like <code>foo/ref2/ref3/ref1 A B C</code>.</p>
<p>To make a long story short: <strong>This works now!</strong>  And reasonably efficiently.  Not only that, SPECIALIZE is smart enough to figure out how to give you one partial refinement "for free", it will just assume it is the last to be fulfilled:</p>
<pre><code>specialize 'append/dup/part [] ;-- legal
specialize 'append/dup [part: true] ;-- legal, assumes append/dup/part
specialize 'append/part [dup: true] ;-- legal, assumes append/part/dup
specialize 'append [part: true dup: true] ;-- ambiguous
</code></pre>
<p>In fact, SPECIALIZE has a fair bit of smarts--automatically realizing you want a refinement just by using its arguments.</p>
<h3>Binding footnote</h3>
<p>The block SPECIALIZE takes is a block of code where SET-WORD! is bound to the arguments of the function.  Regular words are not.  It really runs whatever code otherwise, so you can put IF statements in it, or whatever you like:</p>
<pre><code>&gt;&gt; value: 10

&gt;&gt; apV: specialize 'append [if 1 &lt; 2 [value: value] | print "runs code!"]
runs code!

&gt;&gt; block: copy []

&gt;&gt; apV block
10
</code></pre>
<p>The idea that a WORD! and a SET-WORD! have different bindings in a block of code is a bit odd but not without precedent.  e.g. in C++, <code>class C {int m; C (int m) : m (m + 1) { ... }}</code> has a member initialization syntax, where the <code>m (m + 1)</code> means "initialize member m with the parameter m plus 1".  <em>(It's assumed you aren't interested in initializing the member in terms of itself.)</em></p>
<p>Whether this is a great idea or not, it has seemed useful so far.  Feedback would be useful, as binding remains one of the great bugaboos of the language.</p>
        </div>

        <meta itemprop='headline' content='The now even-more-special SPECIALIZE'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../switching-to-stackless-why-this-why-now/1247/4.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forum.rebol.info/t/switching-to-stackless-why-this-why-now/1247/4'>
                      <span itemprop='name'>Switching to Stackless: Why this, Why now?</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="http://forum.rebol.info/t/positional-apply-as-default-applique-for-frame-style-apply/1103" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='http://forum.rebol.info/t/positional-apply-as-default-applique-for-frame-style-apply/1103'>
                      <span itemprop='name'>Positional APPLY as default, APPLIQUE for FRAME!-style apply</span>
                    </a>
                    <meta itemprop='position' content='3'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../the-about-1-3-of-2018-is-over-report/595.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='http://forum.rebol.info/t/the-about-1-3-of-2018-is-over-report/595'>
                      <span itemprop='name'>The About-1/3-Of-2018-is-Over Report</span>
                    </a>
                    <meta itemprop='position' content='4'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/BlackATTR.html'><span itemprop='name'>BlackATTR</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="588.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-04-12T13:02:01Z' class='post-time'>
                April 12, 2018,  1:02pm
              </time>
              <meta itemprop='dateModified' content='2018-04-12T13:02:01Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Binding is one of the great WTFs of the language. Still, SPECIALIZE seems like it offers a lot of benefits. Looking forward to exploring this. Straight-up fiyah!</p>
        </div>

        <meta itemprop='headline' content='The now even-more-special SPECIALIZE'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
