<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Fringe UDP Support Archiving - Ports - AltRebol</title>
    <meta name="description" content="UDP is supported by libuv, but it&amp;#39;s different enough that code pertaining to it would need redoing.  Right now it&amp;#39;s a distraction, so I&amp;#39;m removing it.  Assuming everything else gets working, it shouldn&amp;#39;t be too hard to a&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1730.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Fringe UDP Support Archiving&#39;" href="1730.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/fringe-udp-support-archiving/1730" />
<meta name="twitter:url" content="https://forum.rebol.info/t/fringe-udp-support-archiving/1730" />
<meta property="og:title" content="Fringe UDP Support Archiving" />
<meta name="twitter:title" content="Fringe UDP Support Archiving" />
<meta property="og:description" content="UDP is supported by libuv, but it&#39;s different enough that code pertaining to it would need redoing.  Right now it&#39;s a distraction, so I&#39;m removing it.  Assuming everything else gets working, it shouldn&#39;t be too hard to add back.  But until more foundational things are working, it has to go.  But in working on some code for messing with little $100 drones, we had added some functions they needed for UDP.  Here are two weird functions I&#39;m putting aside here for now, in case we someday need to reme..." />
<meta name="twitter:description" content="UDP is supported by libuv, but it&#39;s different enough that code pertaining to it would need redoing.  Right now it&#39;s a distraction, so I&#39;m removing it.  Assuming everything else gets working, it shouldn&#39;t be too hard to add back.  But until more foundational things are working, it has to go.  But in working on some code for messing with little $100 drones, we had added some functions they needed for UDP.  Here are two weird functions I&#39;m putting aside here for now, in case we someday need to reme..." />
<meta property="article:published_time" content="2021-10-01T18:27:52+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1730.html">Fringe UDP Support Archiving</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/ports/37" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Ports</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1730.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-10-01T18:27:52Z'>
              <time itemprop='dateModified' datetime='2021-10-01T19:29:15Z' class='post-time'>
                October 1, 2021,  7:29pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>UDP is supported by libuv, but it's different enough that code pertaining to it would need redoing.  Right now it's a distraction, so I'm removing it.  Assuming everything else gets working, it shouldn't be too hard to add back.  But until more foundational things are working, it has to go.</p>
<p>But in working on some code for messing with little $100 drones, we had added some functions they needed for UDP.  Here are two weird functions I'm putting aside here for now, in case we someday need to remember what they were.</p>
<pre><code>//
//  export set-udp-multicast: native [
//
//  {Join (or leave) an IPv4 multicast group}
//
//      return: &lt;none&gt;
//      port [port!]
//          {An open UDP port}
//      group [tuple!]
//          {Multicast group to join (224.0.0.0 to 239.255.255.255)}
//      member [tuple!]
//          {Member to add to multicast group (use 0.0.0.0 for INADDR_ANY)}
//      /drop
//          {Leave the group (default is to add)}
//  ]
//
REBNATIVE(set_udp_multicast)
//
// !!! This was originally the kind of thing that SET-MODES though of using
// RDC_MODIFY for.  But that was never standardized or implemented for
// R3-Alpha (nor was RDC_MODIFY written.  With the networking broken out to
// an extension, it is less of a concern to be including platform-specific
// network calls here (though sockets are abstracted across Windows and POSIX,
// one still doesn't want it in the interpreter core...e.g. when the WASM
// build doesn't use it at all.)
{
    NETWORK_INCLUDE_PARAMS_OF_SET_UDP_MULTICAST;

    SOCKREQ *sock = Sock_Of_Port(ARG(port));

    if (not (sock-&gt;transport == TRANSPORT_UDP))  // !!! other checks?
        rebJumps("fail {SET-UDP-MULTICAST used on non-UDP port}");

    struct ip_mreq mreq;
    Get_Tuple_Bytes(&amp;mreq.imr_multiaddr.s_addr, ARG(group), 4);
    Get_Tuple_Bytes(&amp;mreq.imr_interface.s_addr, ARG(member), 4);

    int result = setsockopt(
        sock-&gt;fd,
        IPPROTO_IP,
        REF(drop) ? IP_DROP_MEMBERSHIP : IP_ADD_MEMBERSHIP,
        cast(char*, &amp;mreq),
        sizeof(mreq)
    );

    if (result &lt; 0)
        rebFail_OS (result);

    return rebNone();
}


//
//  export set-udp-ttl: native [
//
//  {Set the TTL of a UDP port}
//
//      return: &lt;none&gt;
//      port [port!]
//          {An open UDP port}
//      ttl [integer!]
//          {0 = local machine only, 1 = subnet (default), or up to 255}
//  ]
//
REBNATIVE(set_udp_ttl)
//
// !!! See notes on SET_UDP_MULTICAST
{
    NETWORK_INCLUDE_PARAMS_OF_SET_UDP_TTL;

    SOCKREQ *sock = Sock_Of_Port(ARG(port));

    if (not (sock-&gt;transport == TRANSPORT_UDP))  // !!! other checks?
        rebJumps("fail {SET-UDP-TTL used on non-UDP port}");

    int ttl = VAL_INT32(ARG(ttl));
    int result = setsockopt(
        sock-&gt;fd,
        IPPROTO_IP,
        IP_TTL,
        cast(char*, &amp;ttl),
        sizeof(ttl)
    );

    if (result &lt; 0)
        rebFail_OS (result);

    return rebNone();
}
</code></pre>
<p>There's also this comment on why UDP sockets go through the "listening" process, which is really just to bind...this is more obvious in libuv:</p>
<pre><code>    // !!! This modification was made to support a UDP application which
    // wanted to listen on a UDP port, as well as make packets appear to
    // come from the same port it was listening on when writing to another
    // UDP port.  But the only way to make packets appear to originate
    // from a specific port is using bind:
    //
    // https://stackoverflow.com/q/9873061
    //
    // So a second socket can't use bind() to listen on that same port.
    // Hence, a single socket has to be used for both writing and for
    // listening.  This tries to accomplish that for UDP by going ahead
    // and making a port that can both listen and send.  That processing
    // is done during CONNECT.
</code></pre>
<p>I'll mention also that I don't know what this is about; removing it unless a good example comes up:</p>
<pre><code>// Prevent sendmsg/write raising SIGPIPE the TCP socket is closed:
// https://stackoverflow.com/q/108183/
// Linux does not support SO_NOSIGPIPE
//
#ifndef MSG_NOSIGNAL
    #define MSG_NOSIGNAL 0
#endif

#if defined(SO_NOSIGPIPE)
  //
  // Prevent sendmsg/write raising SIGPIPE if the TCP socket is closed:
  // https://stackoverflow.com/q/108183/
  //
  int on = 1;
  if (setsockopt(sock, SOL_SOCKET, SO_NOSIGPIPE, &amp;on, sizeof(on)) &lt; 0) {
      return false;
  }
#endif

// Set non-blocking mode. Return TRUE if no error.
#ifdef FIONBIO
  unsigned long mode = 1;
  return IOCTL(sock, FIONBIO, &amp;mode) == 0;
#else
   int flags;
   flags = fcntl(sock, F_GETFL, 0);
   flags |= O_NONBLOCK;
   return fcntl(sock, F_SETFL, flags) &gt;= 0;
#endif</code></pre>
        </div>

        <meta itemprop='headline' content='Fringe UDP Support Archiving'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
