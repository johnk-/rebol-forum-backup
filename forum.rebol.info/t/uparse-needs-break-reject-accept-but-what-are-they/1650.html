<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>UPARSE needs BREAK, REJECT, ACCEPT... But What Are They? - Internals - AltRebol</title>
    <meta name="description" content="When something doesn&amp;#39;t sit right in my head, I notice.  Like how I could never remember in the beginning what GET-WORD! or SET-WORD! in PARSE did.  (e.g. is a GET-WORD! GET-ing the parse position to SET a variable, or GE&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1650.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?&#39;" href="1650.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/uparse-needs-break-reject-accept-but-what-are-they/1650" />
<meta name="twitter:url" content="https://forum.rebol.info/t/uparse-needs-break-reject-accept-but-what-are-they/1650" />
<meta property="og:title" content="UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?" />
<meta name="twitter:title" content="UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?" />
<meta property="og:description" content="When something doesn&#39;t sit right in my head, I notice.  Like how I could never remember in the beginning what GET-WORD! or SET-WORD! in PARSE did.  (e.g. is a GET-WORD! GET-ing the parse position to SET a variable, or GET-ting a variable&#39;s value to use to SET the parse position?)  And I never really understood ACCEPT, REJECT, BREAK, and FAIL.  I Currently Consider the FAIL Confusion &quot;Solved&quot; Things have settled nicely, in that LOGIC! is used to get a pure &quot;keep going&quot; or &quot;stop&quot;.  So FAIL is repl..." />
<meta name="twitter:description" content="When something doesn&#39;t sit right in my head, I notice.  Like how I could never remember in the beginning what GET-WORD! or SET-WORD! in PARSE did.  (e.g. is a GET-WORD! GET-ing the parse position to SET a variable, or GET-ting a variable&#39;s value to use to SET the parse position?)  And I never really understood ACCEPT, REJECT, BREAK, and FAIL.  I Currently Consider the FAIL Confusion &quot;Solved&quot; Things have settled nicely, in that LOGIC! is used to get a pure &quot;keep going&quot; or &quot;stop&quot;.  So FAIL is repl..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2021-08-07T11:51:18+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1650.html">UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/internals.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Internals</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1650.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-08-07T11:51:18Z'>
              <time itemprop='dateModified' datetime='2021-08-07T14:20:09Z' class='post-time'>
                August 7, 2021,  2:20pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>When something doesn't sit right in my head, I notice.  Like how I could never remember in the beginning what GET-WORD! or SET-WORD! in PARSE did.  <em>(e.g. is a GET-WORD! GET-ing the parse position to SET a variable, or GET-ting a variable's value to use to SET the parse position?)</em></p>
<p>And I never really understood ACCEPT, REJECT, BREAK, and FAIL.</p>
<h2>I Currently Consider the FAIL Confusion "Solved"</h2>
<p>Things have settled nicely, in that LOGIC! is used to get a pure "keep going" or "stop".  So FAIL is replaced simply by FALSE.  It means <strong>if (expression-returning-logic)</strong> is replaced in UPARSE as <strong>:(expression-returning-logic)</strong>, and we can keep FAIL on the meaning of "raise error".</p>
<p>This generalization has the pleasing property that we don't need to go introducing "parse switch" or "parse case" or any such things.  Since NULL means the same thing as #[true] for a GET-GROUP! splice, you have every option at your disposal.</p>
<h2>BREAK and REJECT Seem Too Similar</h2>
<p>The problem I have is that BREAK sounds a lot like "this didn't work".  In fact, I've enforced that loops return NULL if-and-only-if you BREAK them:</p>
<pre><code>&gt;&gt; repeat 3 [break]
; null

&gt;&gt; repeat 3 [null]
== ~null~  ; isotope
</code></pre>
<p>A NULL is used as a signal of "soft failure", e.g. it causes ELSE to run.</p>
<pre><code> &gt;&gt; repeat 3 [break] else [print "soft failure"]
 soft failure

 &gt;&gt; repeat 3 [null] else [print "soft failure"]
 == ~null~  ; isotope
</code></pre>
<p>So the distinction between BREAK and REJECT seems a thin one.  I feel like I'd rather that BREAK meant you decided the iterated rule isn't working out...and some other signal indicated that you want to accept it and go on.</p>
<p>But ACCEPT doesn't really hint at ceasing iteration.  Perhaps STOP?  As a word, it hints more at the ceasing of an iteration...and that's used in CYCLE.</p>
<pre><code>&gt;&gt; cycle [stop]
== ~void~  ; isotope
</code></pre>
<p>Unlike BREAK (which always returns NULL) it is able to return a non-NULL...and a NULL will be isotopified so it won't be seen as a "soft failure" by ELSE:</p>
<pre><code>&gt;&gt; cycle [stop 10]
== 10

&gt;&gt; cycle [stop null]
== ~null~  ; isotope
</code></pre>
<p>Similarly, if you're going to be saying an iterative construct in PARSE is to keep going, then you should have an opportunity to say what the value synthesized from that rule will be.  This requires "endable" rules (because we want a plain stop to work).  I think that's doable.</p>
<p>So I guess I'm saying prefer BREAK to mean rule failed... return NULL.  And STOP to mean rule succeeded.  Default to returning a void isotope if no argument given, but allow an argument.  The argument would be a rule, so you could actually make the STOP a rule.</p>
<pre><code>&gt;&gt; uparse "aaab" [while ["a" (print "A") | stop ["b" (1020)]]]
A
A
A
== 1020
</code></pre>
<h2>What About CONTINUE ?</h2>
<p>If your loop is only one deep in alternates, then all an alternate needs to do continue is succeed:</p>
<pre><code>&gt;&gt; uparse "aaab" [while ["a" comment "continue" | "b" comment "continue"]]
</code></pre>
<p>But if you're deeper than that, it is trickier.  And I don't see any particular reason why you shouldn't be able to ask a rule to CONTINUE a loop.</p>
<pre><code>&gt;&gt; uparse "abbbaccc" [while [
    "a" [some "bbb" (print "BBB"), continue | some "ccc" (print "CCC")]
    (print "like this!")
]
BBB
CCC
like this!
</code></pre>
<p>And CONTINUE could also take an argument, which would matter only if it was the final iteration:</p>
<pre><code>&gt;&gt; uparse "bba" [repeat (3) ["a" continue (&lt;like this&gt;) | "b"]]
== &lt;like this&gt;
</code></pre>
<h2>Would That Be an Improvement?</h2>
<p>I think CONTINUE is pretty obviously useful.</p>
<p>One thing that's a bit weird about what I suggest is that when a BREAK happens in a <em>non-parse</em> loop, the code after it runs.</p>
<p>But the idea that "failure" stops progression is a cross-cutting design aspect in PARSE.  It seems consistent to me.</p>
<p>Yet another issue is that STOP is not currently offered by plain WHILE or REPEAT or FOR-EACH or other loops.  The reason is that if you are to try and write your own iterator in terms of other iterators, you cannot tell from the outside if a "cease iterating" intention happened.</p>
<p>Consider this:</p>
<pre><code>&gt;&gt; opaque-code: [print "looping", 1000 + 20]

&gt;&gt; repeat 2 (opaque-code) then [repeat 2 (opaque-code)]
looping
looping
looping
looping
== 1020
</code></pre>
<p>That's nice because if the opaque-code has a break, the whole thing will break:</p>
<pre><code>&gt;&gt; opaque-code: [print "entering", break]

&gt;&gt; repeat 2 (opaque-code) then [repeat 2 (opaque-code)]
entering
; null
</code></pre>
<p>But if you permit STOP to return a value, the stopping intent is lost:</p>
<pre><code>&gt;&gt; opaque-code: [print "entering", stop 1020]

&gt;&gt; repeat 2 (opaque-code) then [repeat 2 (opaque-code)]
entering
entering
== 1020
</code></pre>
<p>When you're trying to write compound looping expressions that are built up of smaller loops, this really matters.  CYCLE is an oddball because you know the only way it <em>ever</em> terminates with a value is if there was a stopping intent...which is why it allows STOP.</p>
<h2>Maybe ACCEPT and REJECT Should Be Used and No BREAK?</h2>
<p>...but this kind of runs into the same problem that non-PARSE WHILE doesn't have ACCEPT or REJECT.  So why get worked up about it having STOP when non-PARSE WHILE doesn't have STOP, if it makes everything line up?</p>
<p>Or maybe non-PARSE while <em>can</em> have STOP...you just understand that STOP has limits when it comes to loop abstraction.  Not everything works all the time.  So STOP can have a warning on it that you can't tell the stopping intent happened from outside a loop that isn't CYCLE...</p>
<h2>What Do You Think?</h2>
<p>Are the needs of PARSE different, or the same?  Should BREAK make the overall expression evaluate to NULL <em>but</em> keep going?  Are ACCEPT and REJECT the right answer?</p>
<p>It's hard to say.  I have to work out the mechanism by which such things could work in usermode combinators whatever you call them...so there's time to think about it.</p>
        </div>

        <meta itemprop='headline' content='UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1650.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-08-08T04:09:58Z'>
              <time itemprop='dateModified' datetime='2021-08-11T22:47:38Z' class='post-time'>
                August 11, 2021, 10:47pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I'd like some weighing in here if possible from <a class="mention" href="https://forum.rebol.info/u/brett">@Brett</a>, <a class="mention" href="https://forum.rebol.info/u/ingohohmann">@IngoHohmann</a>, <a class="mention" href="https://forum.rebol.info/u/giuliolunati">@giuliolunati</a>, <a class="mention" href="https://forum.rebol.info/u/rgchris">@rgchris</a>, and whoever else might have specific interest in PARSE...</p>
<p>My proposal above is like this:</p>
<pre><code>&gt;&gt; uparse? "aaa" [some ["a" stop] "aa"]  ; the SOME succeeds here
== #[true]

&gt;&gt; uparse? "aaa" [opt some ["a" break] "aaa"]  ; the SOME fails here
== #[true]
</code></pre>
<p>This is different from history, and Red:</p>
<pre><code>red&gt;&gt; parse "aaa" [some ["a" break] "aa"]
== true
</code></pre>
<p>As further proof that I still don't understand REJECT:</p>
<pre><code>red&gt;&gt; parse "aaa" [opt some ["a" reject] "aaa"]
== false

red&gt;&gt; parse "aaa" [some ["a" reject] | "aaa"]
== true
</code></pre>
<p>So REJECT seems to be disconnected from iteration, but instead means "don't just fail this rule, but fail all rules in the current alternative".  Red's <a href="https://www.red-lang.org/2013/11/041-introducing-parse.html">parse introduction</a> claims:</p>
<ul>
<li>
<strong>break</strong> : break out of a matching loop, returning success.</li>
<li>
<strong>reject</strong> : break out of a matching loop, returning failure.</li>
</ul>
<p>But they have tests like:</p>
<pre><code>red&gt;&gt; parse [] [break]
== true
</code></pre>
<p>Where's the "loop" this is breaking?  I don't get it.  That should be an error in my book.</p>
<p>If ACCEPT and REJECT communicate with the BLOCK! combinator and act on the alternate-level, that needs to be defined better.  Where does it stop?  Once it hits the first alternate?</p>
<p>Again: I literally never understood these.</p>
<p>(UPDATE: I found a Red issue where they debate this, it doesn't seem resolved and as far as I can tell they don't know either: <a href="https://github.com/red/red/issues/3478">Red Issue #3478</a>)</p>
<h2>How about REPEAT and the INTEGER! cominator?</h2>
<p>It seems clear that SOME and WHILE are loops, but is REPEAT a loop?  Is an integer?  Like this:</p>
<pre><code> &gt;&gt; uparse? "aaa" [repeat (3) ["a" stop] "aa"]
 == #[true]

 &gt;&gt; uparse? "aaa" [3 ["a" stop] "aa"]
 == #[true]
</code></pre>
<p>We could say that INTEGER! is not a loop but REPEAT is, which would give you something of a choice.</p>
<p>Anyway, I feel like BREAK's "return null" meaning make the loop-fail-the-parse seems pretty solid.  I could really use some additional thoughts here.</p>
        </div>

        <meta itemprop='headline' content='UPARSE needs BREAK, REJECT, ACCEPT... But What Are They?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
