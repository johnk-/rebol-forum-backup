<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How to deal with users mutating DATE! and TIME! to be invalid? - Datatypes - AltRebol</title>
    <meta name="description" content="2020 is a leap year, so there&amp;#39;s a February 29th: 
&amp;gt;&amp;gt; make date! [29 2 2020]
== 29-Feb-2020

But let&amp;#39;s say you have a year like 2017, in which there is no February 29th.  R3-Alpha and Red are smart enough not to let you M&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="240.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;How to deal with users mutating DATE! and TIME! to be invalid?&#39;" href="240.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/how-to-deal-with-users-mutating-date-and-time-to-be-invalid/240" />
<meta name="twitter:url" content="https://forum.rebol.info/t/how-to-deal-with-users-mutating-date-and-time-to-be-invalid/240" />
<meta property="og:title" content="How to deal with users mutating DATE! and TIME! to be invalid?" />
<meta name="twitter:title" content="How to deal with users mutating DATE! and TIME! to be invalid?" />
<meta property="og:description" content="2020 is a leap year, so there&#39;s a February 29th:  &gt;&gt; make date! [29 2 2020] == 29-Feb-2020  But let&#39;s say you have a year like 2017, in which there is no February 29th.  R3-Alpha and Red are smart enough not to let you MAKE such bad dates, or to load them as literals.  e.g. Red:  &gt;&gt; make date! [28 2 2017] == 28-Feb-2017  &gt;&gt; make date! [29 2 2017] *** Script Error: cannot MAKE/TO date! from: [29 2 2017]  &gt;&gt; 29-Feb-2017 *** Script Error: cannot MAKE/TO date! from: [day month year]  But let&#39;s say y..." />
<meta name="twitter:description" content="2020 is a leap year, so there&#39;s a February 29th:  &gt;&gt; make date! [29 2 2020] == 29-Feb-2020  But let&#39;s say you have a year like 2017, in which there is no February 29th.  R3-Alpha and Red are smart enough not to let you MAKE such bad dates, or to load them as literals.  e.g. Red:  &gt;&gt; make date! [28 2 2017] == 28-Feb-2017  &gt;&gt; make date! [29 2 2017] *** Script Error: cannot MAKE/TO date! from: [29 2 2017]  &gt;&gt; 29-Feb-2017 *** Script Error: cannot MAKE/TO date! from: [day month year]  But let&#39;s say y..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="3 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="6 ❤" />
<meta property="article:published_time" content="2017-08-04T16:20:21+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="240.html">How to deal with users mutating DATE! and TIME! to be invalid?</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/development/datatypes.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Datatypes</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2017-08-04T16:20:21Z'>
              <time itemprop='dateModified' datetime='2020-07-03T17:31:44Z' class='post-time'>
                July 3, 2020,  5:31pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>2020 is a leap year, so there's a February 29th:</p>
<pre><code>&gt;&gt; make date! [29 2 2020]
== 29-Feb-2020
</code></pre>
<p>But let's say you have a year like 2017, in which there is no February 29th.  R3-Alpha and Red are smart enough not to let you MAKE such bad dates, or to load them as literals.  e.g. Red:</p>
<pre><code>&gt;&gt; make date! [28 2 2017]
== 28-Feb-2017

&gt;&gt; make date! [29 2 2017]
*** Script Error: cannot MAKE/TO date! from: [29 2 2017]

&gt;&gt; 29-Feb-2017
*** Script Error: cannot MAKE/TO date! from: [day month year]
</code></pre>
<p>But let's say you aren't making it directly, but mutating a date.  For instance to try to set a February 2017 date's day to the 29th anyway.  In R3-Alpha and Red:</p>
<pre><code>&gt;&gt; date: 28-Feb-2017
== 28-Feb-2017

&gt;&gt; date/day: 29
== 29

&gt;&gt; date
== 1-Mar-2017
</code></pre>
<p>It gets weirder than that.</p>
<pre><code>&gt;&gt; date: 28-Feb-2017
== 28-Feb-2017

&gt;&gt; date/day: 1000
== 1000

&gt;&gt; date
== 28-Oct-2019

&gt;&gt; date/day: -1000
== -1000

&gt;&gt; date
== 3-Jan-2017
</code></pre>
<p>It's doing some kind of off-kilter date math when you assign them.  Note that setting the date to 1000 effectively pushed into the future only by the overflow (assumed your 28 was intentional, and everything beyond that wasn't).  But then going back -1000 made no such assumptions; so you didn't get back where you started.</p>
<p>Where the odd behavior is coming from is a reuse of the normalization code for date math.  Basically, if you start from a valid date and add days / months / years / seconds, you need to reconcile after the math.</p>
<p>But setting date fields item-wise is not date math.  I propose it be held to the same rules as MAKE or LOAD of a DATE!.</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2017-08-04T22:19:52Z'>
              <time itemprop='dateModified' datetime='2017-08-04T22:20:33Z' class='post-time'>
                August 4, 2017, 10:20pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Interestingly, the issue has come up in Red in the past 4 days.  <a href="https://github.com/red/red/issues/2948#issuecomment-319098909" rel="nofollow noopener">This ticket</a> discusses time zones specifically, but the question of "normalization" applies to all of it</p>
<blockquote>
<p>"Personally I think it would be more useful for the user to get an error instead of normalisation for out of range values..." --x8x (thumbs up via meijeru, at least)</p>
</blockquote>
<p><a class="mention" href="https://forum.rebol.info/u/rgchris">@rgchris</a> appears to vote for errors...anyone want to make a case in favor of normalization?</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/gchiu'><span itemprop='name'>gchiu</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2017-08-04T22:47:15Z'>
              <time itemprop='dateModified' datetime='2017-08-04T22:51:22Z' class='post-time'>
                August 4, 2017, 10:51pm
              </time>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Implicit math seems a potential mess, and I don't recall that it was allowed before.</p>
<p>Timezones are a political construct and like dates need to be checked against whatever rules govern those. And I don't see it being useful to do math outside those rules, eg increment timezone so that you're forced to do modulo math.</p>
<p>Anyway I'm in favor of an error.</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Brett.html'><span itemprop='name'>Brett</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2017-08-05T01:02:02Z'>
              <time itemprop='dateModified' datetime='2017-08-05T01:02:26Z' class='post-time'>
                August 5, 2017,  1:02am
              </time>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>An error make more sense.</p>
<p>I also believe that presence or absence of a zone distinguishes between two meanings.</p>
<p><code>5-aug-2017/10:00+0:00</code> is not the same as <code>5-aug-2017/10:00</code><br>
With the first we know exactly what moment in time is represented, with the second we'd need to add a timezone before we know what that moment is.  See the description for iCalendar's <a href="https://tools.ietf.org/html/rfc5545#section-3.3.5" rel="nofollow noopener">DATE WITH LOCAL TIME</a>.</p>
<p>Looking at the Red discussion referenced above, it appears that Red hides the timezone when zone is set to 0.  If that's true, then I'd say it is the wrong way to go.  0 should not mean unset.</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-08-05T15:23:38Z' class='post-time'>
                August 5, 2017,  3:23pm
              </time>
              <meta itemprop='dateModified' content='2017-08-05T15:23:38Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Repeating what I said in chat:</p>
<blockquote>
<p>I'm hearing generally agreement with me, and no real disagreement, so given that DATE! and TIME! math aren't really key interest areas of mine, I'm going to just do what I think is right. The only reason I'm involved here is to help <a class="mention" href="https://forum.rebol.info/u/brett">@Brett</a> with getting what he needs to do done... so beyond that, my interest is limited. So it's on everyone else to put together tests and say what they want.</p>
</blockquote>
<blockquote>
<p>And to sum up "what I think is right": is errors on item-wise setting of date properties which would fail on a MAKE, don't run the normalization code that kicks in after math operations. No time-based math allowed on dates with no time components, and don't consider dates with no time components equal to dates that have a time component. Don't do any time zone math, nor consider dates with time zone components equal to those without.</p>
</blockquote>
<blockquote>
<p>If people want to compare dates and ignore their time or time zone components, that's up to them to do the dropping of time or time zone components before the comparison.</p>
</blockquote>
<blockquote>
<p>My proposal for the refinement to make NOW give back a time without a zone is to use /LOCAL, because I actually think it's cool to demonstrate that Ren-C has "pure locals" and doesn't do something silly with a refinement.</p>
</blockquote>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Brett.html'><span itemprop='name'>Brett</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2017-08-07T10:37:05Z' class='post-time'>
                August 7, 2017, 10:37am
              </time>
              <meta itemprop='dateModified' content='2017-08-07T10:37:05Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I have whipped up these <a href="https://github.com/codebybrett/reb/blob/master/test/dates.test.reb" rel="nofollow noopener">date tests as proposed ren-c date behaviour</a>. I'm wondering what everyone thinks about the implications?</p>
<p>If date has these signatures: DateOnly, DateTime, DateTimeZone then I think a DateOnly needs a time to be compared with a DateTime and a DateTime needs to be "placed" in a zone before it can be compared with a DateTimeZone. I don't see that a DateZone (no time) would be that useful.</p>
<p>I have no idea if the make date! specification will be annoying or fine. I think it is descriptive when aiming to "place" a non-specific Date or DateTime.</p>
<p>Hoping that this is a relatively simple, predictable system of behaviour that can represent different meanings and  draw attention to inadvertent mistakes.</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../the-about-1-3-of-2018-is-over-report/595.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='http://forum.rebol.info/t/the-about-1-3-of-2018-is-over-report/595'>
                      <span itemprop='name'>The About-1/3-Of-2018-is-Over Report</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Brett.html'><span itemprop='name'>Brett</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-01-12T07:16:06Z' class='post-time'>
                January 12, 2018,  7:16am
              </time>
              <meta itemprop='dateModified' content='2018-01-12T07:16:06Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>-bump-</p>
<p>Moreover, I also think that trying to do things like access /utc from a DateOnly should raise an error.</p>
<p>Thoughts?</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-03-21T10:38:18Z' class='post-time'>
                March 21, 2018, 10:38am
              </time>
              <meta itemprop='dateModified' content='2018-03-21T10:38:18Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-post="7" data-topic="240">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/brett/40/177_2.png" class="avatar"> Brett:</div>
<blockquote>
<p>-bump-</p>
</blockquote>
</aside>
<p>Bump again.  We should get what tests we want/need to pass, to pass...and raise the others as issues...just to keep things moving along.</p>
<p>Speaking of tying up loose ends, there were 3 date-related issues from some "rebol2-specific" items in the test suite:</p>
<pre><code>; date! ignores time portion
[equal? 2-Jul-2009 2-Jul-2009/22:20]

[strict-equal? 2-Jul-2009 2-Jul-2009/22:20]
[strict-equal? 2-Jul-2009 2-Jul-2009/00:00:00+00:00]
</code></pre>
<p>So interestingly, Rebol2 said <code>strict-equal? 2-Jul-2009 2-Jul-2009/22:20</code> was true...but both R3-Alpha and Red say that even plain "lax" <code>equal? 2-Jul-2009 2-Jul-2009/22:20</code> is false.</p>
<p>We can make arguments from rigor or based on principles like "it can't be an error, because you shouldn't error when comparing values of the same datatype for equality", etc.  But I feel like what's missing are the use cases.  Why would <em>client code</em> care one way or another?  What kinds of bugs or features happen by biasing this one way or another?  Does anyone have code that is affected and can show the effect?</p>
<p>It almost feels like <strong>on</strong> would be an operator to use here.  <strong>if datetime on 12-Dec-2012 [...]</strong>.  :-/</p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="240.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-07-03T08:23:25Z' class='post-time'>
                July 3, 2021,  8:23am
              </time>
              <meta itemprop='dateModified' content='2021-07-03T08:23:25Z'>
          <span itemprop='position'>#9</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="Brett" data-post="6" data-topic="240">
<div class="title">
<div class="quote-controls"></div>
<img alt="" width="20" height="20" src="https://forum.rebol.info/user_avatar/forum.rebol.info/brett/40/177_2.png" class="avatar"> Brett:</div>
<blockquote>
<p>I have whipped up these <a href="https://github.com/codebybrett/reb/blob/master/test/dates.test.reb">date tests as proposed ren-c date behaviour </a>. I'm wondering what everyone thinks about the implications?</p>
</blockquote>
</aside>
<p>I am tying up loose branches and I found this branch from way back in 2017.</p>
<p>As <a class="mention" href="https://forum.rebol.info/u/brett">@Brett</a> put the effort into writing the tests, I've always kept it around as a <em>"maybe someday"</em>.  But working on time zones is unpleasant and the kind of thing I'd rather let someone else worry about, as it doesn't really touch on my interests in the language.</p>
<p>Yet dates have now come up in a couple of applications...something <a class="mention" href="../../u/jhgorse.html">@jhgorse</a> was doing as well as something <a class="mention" href="https://forum.rebol.info/u/blackattr">@BlackATTR</a> is doing.</p>
<p>We've had a feature implemented that I described, of considering dates with no time component or time zone components to have them as missing (NULL).  This is a distinct state from the 0:00 time zone, e.g. UTC.</p>
<p>So that piece of the puzzle was done.  However, implementing the behaviors was non-trivial and took quite a number of hours.  I expect there will be feedback and requests for more changes...so it will cost even more time.  But maybe people will find it worth it.</p>
<h2>Follows Brett's Tests...Only A Small Difference</h2>
<p>One difference is sort of a technical issue with comparison semantics.  Right now comparison is based on a function that returns -1 for less than, 0 for equal, or 1 for greater than.  This means there's no way to have a different error condition regarding the precision based on whether you're doing a test for equality or greater than / less than, because the comparison function doesn't know which is being requested.</p>
<p>Hence these tests fail, just as doing the other comparisons do:</p>
<pre><code>(not equal? date-110 date-100)
(not equal? date-111 date-100)
</code></pre>
<p>The other difference is that I didn't implement the MAKE code for "deriving" a date from another date.  That's kind of a broader issue of reviewing the nature of MAKE that should be looked at.  I also didn't implement the requested /LOCAL feature yet, to get a local time without a time zone...because I wasn't sure why the /UTC function wouldn't be willing to assume that a time without a time zone was local...there seemed to be some asymmetry there to consider.</p>
<p>Finally, I decided it would be interesting to allow you to assign a time zone to something that did not have a time component...and that this would set the time component to 00:00:00.  It seemed like this offered a pretty fast way to get a precise time from one that didn't have one.</p>
<pre><code>&gt;&gt; t: now/date
== 3-Jul-2021

&gt;&gt; t.zone: 0
== 0

&gt;&gt; t
== 3-Jul-2021/0:00+0:00
</code></pre>
<p>This can reduce the pain of getting precise dates to perform math on from ones that are less precise.  You can also use something like <strong><code>t.zone: default [0]</code></strong> to keep an existing zone but overwrite with 0.  I feel this is expedient enough to help make the more cautious behavior in comparisons a win...since you're a stone's throw from the old behavior if you want it.</p>
<p><a href="https://github.com/metaeducation/ren-c/blob/45af66ababa7e60eb1bc23f90781b9b392b83c66/tests/datatypes/date.test.reb#L84" class="inline-onebox">ren-c/date.test.reb at 45af66ababa7e60eb1bc23f90781b9b392b83c66 · metaeducation/ren-c · GitHub</a></p>
        </div>

        <meta itemprop='headline' content='How to deal with users mutating DATE! and TIME! to be invalid?'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="2" />
           <span class='post-likes'>2 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
