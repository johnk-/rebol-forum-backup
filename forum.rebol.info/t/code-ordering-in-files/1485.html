<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Code Ordering in Files - Modules - AltRebol</title>
    <meta name="description" content="While thinking about how to update the decade-old Whitespace interpreter project, the reorganization fused the spec for operation definitions along with code that was dispatched by the &amp;quot;virtual machine&amp;quot;. 
This reorganiza&amp;hellip;">
    <meta name="generator" content="Discourse 2.7.0.beta4 - https://github.com/discourse/discourse version 3fc72543de22c329cf2156f28b781821adc496ae">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/cbd70027b53fa165575e5b665f00eb3b8ae7ea31_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="1485.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.rebol.info","potentialAction":{"@type":"SearchAction","target":"https://forum.rebol.info/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="AltRebol Search">

      <link href="https://forum.rebol.info/stylesheets/desktop_e71c7b3a0694e7f6434c54a663bfb42821f8bd81.css?__ws=forum.rebol.info" media="all" rel="stylesheet" data-target="desktop" />
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Code Ordering in Files&#39;" href="1485.rss" />
    <meta property="og:site_name" content="AltRebol" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:image" content="https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" />
<meta property="og:url" content="https://forum.rebol.info/t/code-ordering-in-files/1485" />
<meta name="twitter:url" content="https://forum.rebol.info/t/code-ordering-in-files/1485" />
<meta property="og:title" content="Code Ordering in Files" />
<meta name="twitter:title" content="Code Ordering in Files" />
<meta property="og:description" content="While thinking about how to update the decade-old Whitespace interpreter project, the reorganization fused the spec for operation definitions along with code that was dispatched by the &quot;virtual machine&quot;.  This reorganization had the nice property of keeping the code together with the rule.  So it became easier to maintain, and a better showcase of the claimed premise of Rebol-like languages.  Dialect Improvement...at the cost of &quot;First Impressions&quot; An unfortunate side effect of switching away fr..." />
<meta name="twitter:description" content="While thinking about how to update the decade-old Whitespace interpreter project, the reorganization fused the spec for operation definitions along with code that was dispatched by the &quot;virtual machine&quot;.  This reorganization had the nice property of keeping the code together with the rule.  So it became easier to maintain, and a better showcase of the claimed premise of Rebol-like languages.  Dialect Improvement...at the cost of &quot;First Impressions&quot; An unfortunate side effect of switching away fr..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2021-02-01T09:43:44+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="https://forum.rebol.info/">
          <img src="../../uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png" alt="AltRebol" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="1485.html">Code Ordering in Files</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/8" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forum.rebol.info/c/development/modules/21" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #25AAE2'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Modules</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='AltRebol'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forum.rebol.info/uploads/default/original/1X/ae4ccad1a2789bb1e85cf5a0f52f2f1de10da26d.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forum.rebol.info/u/hostilefork'><span itemprop='name'>hostilefork</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="1485.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2021-02-01T09:43:44Z'>
              <time itemprop='dateModified' datetime='2021-09-10T20:10:52Z' class='post-time'>
                September 10, 2021,  8:10pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>While thinking about how to <a href="../whitespace-interpreter-revisited/1482/5.html">update the decade-old Whitespace interpreter project</a>, the reorganization fused the spec for operation definitions along with code that was dispatched by the "virtual machine".</p>
<p>This reorganization had the nice property of keeping the code together with the rule.  So it became easier to maintain, and a better showcase of the claimed premise of Rebol-like languages.</p>
<h2>Dialect Improvement...at the cost of "First Impressions"</h2>
<p>An unfortunate side effect of switching away from inert blocks to using dialecting functions is that <em>those functions must be defined before using them</em>.</p>
<ul>
<li>
<p>Look at how the <a href="https://github.com/hostilefork/rebol-whitespacers/blob/5e91fa1ebfbe093b17ea8f49858e79354c33baec/historical/whitespace-old.reb#L170">original implementation started off</a>, going straight into the command specifications.</p>
</li>
<li>
<p>Then look at the <a href="https://github.com/hostilefork/whitespacers/blob/4f9e6ce0137658e3809dc24ac1bcc988f1119d83/ren-c/whitespace.reb#L46">first declarations in the reboot, for CATEGORY and INSTRUCTION</a>.  Intimidating!</p>
</li>
</ul>
<p>Even though the specification as a whole got much tighter, <em>the voodoo to get them working is the first thing people see</em>.  Those definitions are more bewildering right now than they'll need to be after whipping things into shape (we hope).  But no matter what, they're going to be harder to look at than if we could start with the nice command definitions.</p>
<h2>Breaking Things Into Their Own Files Is Possible... but...</h2>
<p>The blunt tool we have at the moment for dealing with this "first impressions problem" is to move stuff into multiple files.  So <code>%ws-dialect.reb</code> for defining things like CATEGORY and OPERATION.  Then include that into <code>%ws-commands.reb</code> for the command list.  Probably even splitting out <code>%ws-interpreter.reb</code> for the actual engine.</p>
<p>But something about this feels disheartening.  The reason it would get broken up isn't really because of any problem with the length per se...the end goal is an amount of code that would be reasonable as one file.  <strong>It sucks if you have to break it into more files due to a language limitation that doesn't let you organize things within the file the way that you want.</strong></p>
<h2>The Nature Of Rebol Is Rigid Ordering</h2>
<p>Languages have been moving toward a model where within a file, it doesn't matter what order you put things in.  Compilers like Rust don't have to "forward declare" functions, you can use them at the top of a file and declare them later.</p>
<p>But a language need not be compiled to let you use things out of order.  Python is interpreted and you can use a function at the top of a file and declare it at the end.</p>
<p>So what's Rebol's excuse?</p>
<p><strong>Rebol is in a different boat fundamentally: it can't "scan ahead" to catalog things, because it can't know what the words defining that thing would mean at the moment it would naturally encounter it.</strong>.</p>
<p>The problem is that fundamentals like "what declares a function" can change on a whim.  The interpreter can't go scouting for the FUNC word and create a note like "oh, a function will be declared in the future!" so that information is available ahead of time.  The meaning of FUNC itself could be slated for change, so it could get a false positive.  Or it could get a false negative: skipping something that's an abstraction for declaring functions it hasn't heard about.</p>
<h2>What If You Could Specify An Out-Of-Order Ordering?</h2>
<p>Something that crossed my mind for dealing with the particular situation in Whitespace file was if there was some kind of syntax for "sections", as well as being able to say what order those sections run in.</p>
<p>A first thought might be of something like this:</p>
<pre><code>Rebol [
   Type: 'Module
   Section-Run-Order: [Dialect Interpreter Commands]
]

Commands: Section [
    Stack-Manipulation: category [...]
    Arithmetic: category [...]
    ...
]

Dialect: Section [
    category: func [...] [...]
    operation: func [...] [...]
]

Interpreter: Section [...]
</code></pre>
<p>But that's awkward, and it also is invasive to the module's operation (pushing top-level declarations into blocks throws a wrench into everything).</p>
<p>More reasonable would be if you could put multiple module definitions in a file.  Then they could automatically sort out their dependencies and find a non-conflicting order:</p>
<pre><code>Rebol [
   Type: 'Module
   Name: 'Whitespace-Commands
   Needs: [Whitespace-Dialect Whitespace-Interpreter]
]

Stack-Manipulation: category [...]
Arithmetic: category [...]

Rebol [  ; imagine still in same file...
    Type: 'Module
    Name: 'Whitespace-Dialect
]

category: func [...] [...]
operation: func [...] [...]

Rebol [
    Type: 'Module
    Name: 'Whitespace-Interpreter
]

...
</code></pre>
<p><strong>Having something like this where the order is figured out by the system seems appealing, and this lets you make the "new file" decision on its own merits rather than be forced into it.</strong></p>
<p>I'll point out to <a class="mention" href="https://forum.rebol.info/u/rgchris">@rgchris</a> that being able to put multiple "units" into a single file is another good argument for my <a href="../plugging-the-script-header-hole/1430.html">"out of band signal" of module-ness</a>.  You wouldn't accidentally wind up taking these modules as an argument to a function--they'd clearly escape out of legal syntax and set up a boundary for where units began and ended.</p>
<p>Right now the whitespace interpreter even has a demo file embedded in it... that's kind of cool, and it would be nice if whatever header-isms you'd put in a standalone file could be put on a unit that tagged along inside of another file.</p>
<p><strong>You'd still need some way of saying the file was an aggregate, and explain why everything is glued together in the same file.</strong>  Not having that would make it confusing if you were looking for those parts and couldn't find them.  Still, it could be optional...as the whole file has to be scanned before running anyway, so it would see all the modules in it.</p>
<pre><code>Aggregator&gt; [
    Contents: [
        Whitespace-Commands
        Whitespace-Dialect
        Whitespace-Interpreter
        Demo
    ]
    Description: {
        This file packages together Whitespace components as one file, for easier
        transmission and maintenance.
    }
]

Module&gt; [
    Name: 'Whitespace-Commands
    ...
]
</code></pre>
<p>It might be interesting if some properties could be inherited by the contained modules from the aggregator if they weren't overridden (date? license?)</p>
<p>This is all pretty far out, but, unless there's something like this the only way you're going to shuffle the order is breaking things into files.</p>
<h2>Tech Note: Execution Does Scan Ahead, But Only for Binding</h2>
<p>If you follow through <a href="../the-real-story-about-user-and-lib-contexts/764.html">"The Real Story about User and Lib Contexts"</a> you can see how Rebol winds up in the situation where you can have a variable declared after a function and it can still be <em>bound</em> in functions prior to its SET-WORD!.</p>
<pre><code>&gt;&gt; foo: bar: x: '~unset~
&gt;&gt; do [
    bar: func [] [foo]
    foo: func [] [print ["X is" x]]
    x: 1020
    bar
]

X is 1020
</code></pre>
<p>So some "looking ahead" is definitely going on.</p>
<p>But this only means the <em>binding</em> is available "a priori".  The <em>value</em> doesn't get put into the variable until the SET-WORD! actually reaches the evaluation.</p>
<pre><code>&gt;&gt; foo: bar: x: '~unset~
&gt;&gt; do [
    bar: func [] [foo]
    bar  ; too early
    foo: func [] [print ["X is" x]]
    x: 1020
]
** Script Error: foo is ~unset~
</code></pre>
<p>You can try and think up imaginative (crazy) ways to deal with this.  For instance: going through a prepass and turning everything into a function stub that couples up SET-WORD!s with code after them, and then caches them on-demand when they're called.  That might be fun for special cases, but the generic stub functions would be variadic...and not everything is a function so you'd get false answers for <strong>get 'word</strong> saying things were ACTION! when they weren't... etc. etc.</p>
<p>So I think it's unwise to fight this.  It's better to think about more interesting ways to express the ordering, than to defy the nature of the language to lie and make it seem order-agnostic.  It isn't.</p>
        </div>

        <meta itemprop='headline' content='Code Ordering in Files'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://forum.rebol.info/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
